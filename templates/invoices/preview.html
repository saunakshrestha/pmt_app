{% load invoice_extras %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>{{ document.doc_type|title }}</title>
    <style>
        body { font-family: Arial, sans-serif; font-size: 10pt; margin: 20px; }
        h1 { text-align: center; font-size: 14pt; }
        .header { text-align: right; margin-bottom: 20px; }
        table { width: 100%; border-collapse: collapse; }
        th, td { border: 1px solid #000; padding: 5px; }
        .desc { word-wrap: break-word; }
        .right { text-align: right; }
        .total { font-weight: bold; }
        .section { margin-top: 20px; }
        .blank-box { border: 1px solid #000; height: 50px; width: 50%; }
        /* Match Xero style: light gray empty rows, etc. */
        .empty td { background: #f0f0f0; height: 20px; }
    </style>
</head>
<body>
    <div class="header">
        <h2>MochaTech Pty Ltd</h2>
        <p>ABN: {% if document.doc_type == "estimate" %}78 995 982 677{% else %}79 690 649 515{% endif %}</p>
        <p>Email: projects@mochatech.com.au</p>
        <p>Phone: 0424055711</p>
        <p>Address: U7, 39 Edinburgh Road WA, 6058. Australia</p>
    </div>

    <h1>{{ document.doc_type|upper }}</h1>

    <p>Customer name: {{ document.customer_name }}</p>
    <p>Customer ABN: {{ document.customer_abn|default:"" }}</p>
    {% if document.doc_type == "invoice" %}
        <p>Attention: {{ document.attention|default:"" }}</p>
        <p>{{ document.customer_address|default:"" }}</p>
        <p>Invoice Date: {{ document.date|date:"d M Y" }}</p>
        <p>Invoice Number: {{ document.number }}</p>
        <p>Reference/PO #: {{ document.po_reference|default:"" }}</p>
        <p>Due Date: {{ document.due_date|date:"d M Y" }}</p>
    {% else %}
        <p>Estimate number: {{ document.number }}</p>
        <p>Date: {{ document.date|date:"d/m/Y" }}</p>
        <p>Estimate valid until: {{ document.valid_until|date:"d/m/Y" }}</p>
    {% endif %}

    {% if document.doc_type == "estimate" and document.summary %}
        <div class="section">
            <h3>SUMMARY OF CUSTOMER REQUIREMENTS</h3>
            {% for item in document.summary %}
                <p>{{ forloop.counter }}. {{ item }}</p>
            {% endfor %}
        </div>
    {% endif %}

    <table>
        <tr>
            <th>Description</th>
            <th>Price</th>
            <th>Quantity</th>
            <th>GST %</th>
            <th>Amount</th>
        </tr>
        {% for item in document.items %}
            <tr>
                <td class="desc">{{ item.description }}</td>
                <td class="right">${{ item.unit_price|floatformat:2 }}</td>
                <td class="right">{{ item.quantity }}</td>
                <td class="right">{{ item.gst_rate|floatformat:2 }}</td>
                <td class="right">${{ item.amount|floatformat:2 }}</td>
            </tr>
        {% endfor %}
        {% if document.doc_type == "estimate" %}
            {% with 20|subtract:document.items|length as empty_rows %}
                {% for i in "x"|rjust:empty_rows %}
                    <tr class="empty"><td colspan="5">&nbsp;</td></tr>
                {% endfor %}
            {% endwith %}
        {% else %}
            {% with 10|subtract:document.items|length as empty_rows %}
                {% for i in "x"|rjust:empty_rows %}
                    <tr class="empty"><td colspan="5">&nbsp;</td></tr>
                {% endfor %}
            {% endwith %}
        {% endif %}
    </table>

    <div class="totals right">
        <p>Subtotal: ${{ document.subtotal|floatformat:2 }}</p>
        <p>Total GST: ${{ document.gst_total|floatformat:2 }}</p>
        <p class="total">TOTAL: ${{ document.grand_total|floatformat:2 }}</p>
    </div>

    {% if document.doc_type == "estimate" %}
        <div class="section">
            <h3>TERMS & CONDITIONS</h3>
            <div class="blank-box"></div>
            <h4>PAYMENT TERMS:</h4>
            <p>{{ document.payment_terms.text|default:"" }}</p>
        </div>
    {% else %}
        <div class="section">
            <h3>Additional notes</h3>
            <p>EFT Details:</p>
            <p>Name: MochaTech Pty Ltd</p>
            <p>Commonwealth Bank of Australia</p>
            <p>BSB: 066 128</p>
            <p>ACC: 1047 2417</p>
        </div>
    {% endif %}

</body>
</html>